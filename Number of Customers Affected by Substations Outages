SELECT DISTINCT
  ef.EVENTNAME,
  ef.FEEDERNAME AS FEEDERNAME,
  ef.SUBSTATIONNAME AS SUBSTATIONNAME,
  ef.NUMCUSTRESTORED AS NUMCUSTRESTORED,
  ef.STARTDATETIME AS STARTDATETIME,
  ef.MAXRESTOREDDATETIME AS MAXRESTOREDDATETIME,
  ef.COMPLETEDDATETIME AS COMPLETEDDATETIME,
  ef.TROUBLE_LVL AS TROUBLE_LVL,
  ef.EVENTLOCATION AS EVENTLOCATION,
  ef.EVENTSTATUSKEY AS EVENTSTATUSKEY,
  ef.CAUSEKEY AS CAUSEKEY,
  ef.MOMENTARYOUTAGEFLAG AS MOMENTARYOUTAGEFLAG,
  ef.DURATIONHM AS DURATIONHM,
  ef.CIRCUITKEY AS CIRCUITKEY,
  ef.AFFECTEDFEEDERS AS AFFECTEDFEEDERS,
  ef.DEVICENAME AS DEVICENAME,
  ef.DEVICEOTGFLAG AS DEVICEOTGFLAG,
  ef.OUTAGEORG AS OUTAGEORG,
  ef.SERVICECENTER AS SERVICECENTER
FROM OBVWH.OMS_EVENT_FACT@FPRP ef
INNER JOIN OBVWH.OMS_RESTORATION_FACT@FPRP rf ON rf.deeneventkey = ef.eventkey
INNER JOIN RRD.TB_CIRCUITOUTAGEHISTORY ch ON ch.eventkey = ef.eventkey
INNER JOIN RRD.SUBSTATION_INVENTORY si ON ef.substationname = si.substation_name
WHERE ef.STARTDATETIME BETWEEN TO_DATE('2024-07-07', 'YYYY-MM-DD') AND TO_DATE('2024-07-10', 'YYYY-MM-DD') + 1
  AND ef.EXCLUDETROUBLEFLAG = 0
  AND ef.MOMENTARYOUTAGEFLAG = 0
  AND ef.CANCELLEDFLAG = 0
  AND ef.PLANNEDOTGFLAG = 0
  AND ef.NONOUTGCALLFLAG = 0
  AND ef.ORPHANOUTAGEFLAG = 0
  AND ef.SERVICECENTER NOT IN ('BV', 'EV', 'FB', 'MV', 'RP', 'INDIANA')
  AND si.SUBSTATION_CODE IN ('IT', 'TWG', 'KW', 'PI', 'IND', 'WBY','MDY', 'TIK')
--  AND ef.SERVICECENTER IN ('IT', 'TWG', 'KW', 'PI', 'IND', 'WBY','MDY', 'TIK')
   AND ef.FEEDERNAME != '-Missing Feeder-'
--  AND ef.trouble_lvl = 'C'
ORDER BY ef.FEEDERNAME, ef.STARTDATETIME;
